import java.util.regex.Pattern

sourceSets.main.allSource.each {
    if (it.text.matches(Pattern.compile(".*public\\s+static\\s+void\\s+main.*", Pattern.DOTALL))) {
        def className = file('src/main/java').toPath().relativize(it.toPath()).join('.').replace(".java", '')
        tasks.register("$className", JavaExec) {
            dependsOn = ['build', 'cleanOutput']
            group = 'samples'
            mainModule = 'org.citygml4j.samples'
            mainClass = className
            classpath = sourceSets.main.runtimeClasspath
        }
    }
}

tasks.register('cleanOutput', Delete) {
    group = 'samples'
    delete 'output'
}